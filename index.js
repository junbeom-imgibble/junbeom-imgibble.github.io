class e{constructor(e){this.setStory=e=>{this.currentStory=e,this.render()},this.getIndex=e=>this.stories.indexOf(this.currentStory)+e,this.goNext=()=>{this.getIndex(0)!==this.stories.length-1&&(this.currentStory=this.stories[this.getIndex(1)],this.render())},this.goPrev=()=>{0!==this.getIndex(0)&&(this.currentStory=this.stories[this.getIndex(-1)],this.render())},this.render=()=>{this.DOM.querySelector("sw-slider").slide(),this.DOM.querySelectorAll("sw-view").forEach((e=>{e.story.id===this.currentStory.id?e.feedStore.active(!0):e.feedStore.active(!1)}))},this.element=e,this.DOM=e.DOM,this.stories=e.stories}}function t(e){return e.getRootNode().host}function n(e){return e.getRootNode()}function s(e){return e.getRootNode().host.stories}function i(e){return e.getRootNode().host.storyStore}function r(e){return function(e){return e.closest("sw-view")}(e).feedStore}function o(e){return n(e).querySelector("sw-layer").toggleAttribute("hidden")}function a(e){return Array.from(e.parentElement.children).indexOf(e)}customElements.define("sw-story",class extends HTMLElement{constructor(){super(...arguments),this.story=JSON.parse(this.getAttribute("story"))}connectedCallback(){this.classList.add("story");const{thumbnail:e,name:s,label:r}=this.story;this.innerHTML=`<div class="story-icon"><img class="story-image" src="${e}"/></div>`;const a=this.querySelector(".story-icon"),c=this.querySelector(".story-image");void 0!==r&&a.insertAdjacentHTML("beforeend",`<div class="story-label">${r}</div>`),void 0!==s&&this.insertAdjacentHTML("beforeend",`<div class="story-title">${s}</div>`);const d=t(this).getAttribute("shape")||"round",l=t(this).getAttribute("border");a.classList.add(d),null!==l&&(a.style.borderRadius=l+"px",c.style.borderRadius=l+"px"),this.onclick=()=>{var e;o(this),i(this).setStory(this.story),(e=this,n(e).querySelector("sw-story-group").readStories).addReadStory(this.story.id)}}}),customElements.define("sw-screen",class extends HTMLElement{connectedCallback(){this.classList.add("screen")}static get observedAttributes(){return["current-feed-id"]}attributeChangedCallback(e,t,n){if("current-feed-id"===e){const e=r(this).currentFeed,{type:t,content:n}=e;"IMAGE"===t&&(this.innerHTML=`<img alt="content" class="content" src="${n}"/>`),"VIDEO"===t&&(this.innerHTML=`<video class="content" src="${n}" autoplay loop/>`)}}}),customElements.define("sw-feed-element",class extends HTMLElement{constructor(){super(...arguments),this.properties=["left","top","width","height"]}connectedCallback(){this.classList.add("feed-element"),this.properties.map((e=>this.style[e]=this.getAttribute(e)+"%"));const e=this.getAttribute("src");this.innerHTML=`<img alt="sticker" width="100%" height="100%" src="${e}"/>`}}),customElements.define("sw-canvas",class extends HTMLElement{connectedCallback(){this.classList.add("canvas")}static get observedAttributes(){return["current-feed-id"]}attributeChangedCallback(e,t,n){if("current-feed-id"===e){const e=r(this).currentFeed.elements;this.innerHTML=void 0===e?null:e.map((e=>{const{width:t,height:n,position_x:s,position_y:i,sticker:r}=e;return`<sw-feed-element\n                    src=${r} width=${t}\n                    height=${n} left=${s} top=${i}>\n                </sw-feed-element>\n                `})).join("")}}});var c=new class{constructor(){this.setProgress=e=>{clearInterval(this.timer),this.element=e,this.gauge=e.querySelector(".gauge"),this.timer=setInterval(this.runProgress,10)},this.runProgress=()=>{this.element.currentTime+=1;const e=this.element.currentTime/(100*this.element.duration);this.gauge.style.width=100*e+"%",e>=1&&(this.element.currentTime=0,r(this.element).goNext())}}};customElements.define("sw-progress",class extends HTMLElement{constructor(){super(...arguments),this.currentTime=0,this.duration=Number(this.getAttribute("duration")),this.feedId=this.getAttribute("feed-id")}connectedCallback(){this.classList.add("progress"),this.style.width=this.getAttribute("width")+"%",this.innerHTML="<div class='gauge'/>",this.gauge=this.querySelector(".gauge")}setFullGauge(){this.gauge.style.width="100%"}setEmptyGauge(){this.gauge.style.width="0%"}resetCurrentTime(){this.currentTime=0}static get observedAttributes(){return["current-feed-id"]}attributeChangedCallback(e,t,n){"current-feed-id"===e&&this.feedId===n&&c.setProgress(this)}}),customElements.define("sw-timeline",class extends HTMLElement{constructor(){super(...arguments),this.feeds=function(e){const t=e.closest("sw-view");return null!==t&&t.story}(this).feeds}connectedCallback(){this.classList.add("timeline");const e=this.feeds.map((e=>e.duration)).reduce(((e,t)=>e+t),0);this.innerHTML=this.feeds.map((t=>{const{id:n,duration:s}=t;return`<sw-progress feed-id=${n} duration=${s} width=${s/e*100}></sw-progress>`})).join("")}static get observedAttributes(){return["current-feed-id"]}attributeChangedCallback(e,t,n){if("current-feed-id"===e){const e=this.querySelectorAll("sw-progress");e.forEach((e=>e.setEmptyGauge()));const t=this.feeds.map((e=>e.id)).indexOf(n);Array.from(Array(t).keys()).forEach((t=>e.item(t).setFullGauge()))}}}),customElements.define("sw-interface",class extends HTMLElement{connectedCallback(){this.classList.add("interface"),this.innerHTML='\n        <div class="interface-frame">\n            <sw-timeline current-feed></sw-timeline>\n            <div class="icon-container">\n                <sw-icon icon="inner-close"></sw-icon>\n            </div>\n            <sw-icon icon="share"></sw-icon>\n            <sw-icon icon="heart"></sw-icon>\n        </div>\n        '}}),customElements.define("sw-controller",class extends HTMLElement{connectedCallback(){this.classList.add("controller"),this.innerHTML='\n            <sw-icon icon="left"></sw-icon>\n            <sw-icon icon="right"></sw-icon>\n        '}});const d=["sw-canvas","sw-screen","sw-timeline","sw-progress"];class l{constructor(e){this.getIndex=e=>this.feeds.indexOf(this.currentFeed)+e,this.goNext=()=>{this.getIndex(1)!==this.feeds.length?(this.currentFeed=this.feeds[this.getIndex(1)],this.render()):i(this.element).goNext()},this.goPrev=()=>{0!==this.getIndex(0)?(this.currentFeed=this.feeds[this.getIndex(-1)],this.render()):i(this.element).goPrev()},this.active=e=>{Array.from(Array(this.element.childElementCount).keys()).forEach((t=>this.element.children.item(t).style.display=e?"flex":"none"));this.element.querySelector(".view-thumbnail").style.display=e?"none":"flex"},this.render=()=>{d.map((e=>this.element.querySelectorAll(e).forEach((e=>e.setAttribute("current-feed-id",this.currentFeed.id)))))},this.element=e,this.feeds=this.element.story.feeds,this.currentFeed=this.feeds[0]}}customElements.define("sw-view",class extends HTMLElement{constructor(){super(...arguments),this.story=JSON.parse(this.getAttribute("story")),this.feedStore=new l(this)}connectedCallback(){this.classList.add("view"),this.innerHTML=`\n            <img alt="view-thumbnail" class="view-thumbnail" src="${this.story.thumbnail}"/>\n            <div class="view-inner">\n                <sw-screen></sw-screen>\n                <sw-canvas></sw-canvas>\n                <sw-interface></sw-interface>\n            </div>\n            <sw-controller></sw-controller>\n        `}});class h{constructor(e){this.addReadStory=e=>{const t=new Set(this.readStoriesId);t.add(e),sessionStorage.setItem("readStories",JSON.stringify([...t])),this.render(e)},this.checkReadStories=()=>{this.readStoriesId.map((e=>this.render(e)))},this.element=e,this.readStoriesId=JSON.parse(sessionStorage.getItem("readStories"))||new Array}render(e){const t=Array.from(this.element.querySelectorAll("sw-story")).find((t=>t.story.id===e));null!==t&&(t.firstElementChild.style.backgroundImage="none")}}customElements.define("sw-story-group",class extends HTMLElement{constructor(){super(...arguments),this.readStories=new h(this)}connectedCallback(){this.classList.add("story-group");const e=s(this),n=t(this).getAttribute("type")||"group";"group"===n&&(this.innerHTML=e.map((e=>`<sw-story story=${JSON.stringify(e)}></sw-story>`)).join("")),"single"===n&&(this.innerHTML=`<sw-story story=${JSON.stringify(e[0])}></sw-story>`),"embed"===n&&(this.innerHTML="<sw-view></sw-view>"),this.readStories.checkReadStories()}}),customElements.define("sw-view-container",class extends HTMLElement{connectedCallback(){this.classList.add("view-container"),this.innerHTML=s(this).map((e=>`<sw-view story=${JSON.stringify(e)}></sw-view>`)).join("")}});customElements.define("sw-slider",class extends HTMLElement{connectedCallback(){this.classList.add("slider"),this.innerHTML='<div class="axis"><sw-view-container></sw-view-container></div>';const e=t(this).getAttribute("direction")||"horizontal",n=this.querySelector(".axis");"horizontal"===e&&(n.style.alignItems="center")}slide(){if(void 0===i(this).getIndex(0))return;const e=this.querySelector("sw-view-container"),t=this.querySelectorAll("sw-view"),n=this.querySelectorAll("sw-view").item(1),s=t[1].offsetLeft-t[0].offsetLeft,r=n.offsetWidth/2,o=-(s*a(n)+r);e.style.left=o+"px",window.innerWidth>500&&t.forEach((e=>{const t=1.4-(Math.abs(a(n)-a(e))+1)/8;e.style.transform=`scale(${t})`}))}});const u='<path d="M19.625 17.9315C20.075 18.4299 20.075 19.1776 19.625 19.6262C19.125 20.1246 18.375 20.1246 17.925 19.6262L12.025 13.6947L6.075 19.6262C5.575 20.1246 4.825 20.1246 4.375 19.6262C3.875 19.1776 3.875 18.4299 4.375 17.9315L10.325 12L4.375 6.06854C3.875 5.57009 3.875 4.82243 4.375 4.37383C4.825 3.87539 5.575 3.87539 6.025 4.37383L12.025 10.3551L17.975 4.42368C18.425 3.92523 19.175 3.92523 19.625 4.42368C20.125 4.87227 20.125 5.61994 19.625 6.11838L13.675 12L19.625 17.9315Z"/>';customElements.define("sw-icon",class extends HTMLElement{connectedCallback(){this.classList.add("icon");const e=this.getAttribute("icon");this.innerHTML='<svg width="100%" height="100%" viewBox="0 0 24 24" fill="currentColor"/>';const t=this.querySelector("svg");switch(e){case"outer-close":this.classList.add("outer-close"),t.innerHTML=u,this.onclick=()=>o(this);break;case"inner-close":this.classList.add("inner-close"),t.innerHTML=u,this.onclick=()=>o(this);break;case"left":this.classList.add("arrow"),t.innerHTML='<path d="M13.8594 18.4621L8.27344 12.5246C8.11719 12.3293 8 12.0949 8 11.8605C8 11.6652 8.11719 11.4309 8.27344 11.2355L13.8594 5.29804C14.2109 4.90742 14.7969 4.90742 15.1875 5.25898C15.5781 5.61054 15.5781 6.19648 15.2266 6.58711L10.1875 11.8996L15.2266 17.173C15.5781 17.5637 15.5781 18.1496 15.1875 18.5012C14.7969 18.8527 14.2109 18.8527 13.8594 18.4621Z"/>',this.onclick=()=>r(this).goPrev();break;case"right":this.classList.add("arrow"),t.innerHTML='<path d="M9.62617 5.29804L15.2121 11.2355C15.3684 11.4309 15.4855 11.6652 15.4855 11.8605C15.4855 12.0949 15.3684 12.3293 15.2121 12.5246L9.62617 18.4621C9.27461 18.8527 8.68867 18.8527 8.29804 18.5012C7.90742 18.1496 7.90742 17.5637 8.25898 17.173L13.259 11.8605L8.25898 6.58711C7.90742 6.19648 7.90742 5.61054 8.29804 5.25898C8.68867 4.90742 9.27461 4.90742 9.62617 5.29804Z"/>',this.onclick=()=>r(this).goNext();break;case"heart":this.classList.add("heart"),t.innerHTML='<path d="M11.5312 5.60624L11.9609 6.07499L12.4297 5.6453C13.7188 4.35624 15.5547 3.7703 17.3125 4.0828C20.0078 4.51249 22 6.85624 22 9.59061V9.78592C22 11.4265 21.2969 12.989 20.125 14.0828L13.0547 20.6844C12.7812 20.9578 12.3906 21.075 12 21.075C11.5703 21.075 11.1797 20.9578 10.9062 20.6844L3.83594 14.0828C2.66406 12.989 2 11.4265 2 9.78592V9.59061C2 6.85624 3.95312 4.51249 6.64844 4.0828C8.40625 3.7703 10.2422 4.35624 11.5312 5.60624C11.5312 5.6453 11.4922 5.60624 11.5312 5.60624ZM11.9609 8.73124L10.2031 6.93436C9.34375 6.11405 8.13281 5.72342 6.96094 5.91874C5.16406 6.23124 3.875 7.75467 3.875 9.59061V9.78592C3.875 10.9187 4.30469 11.9734 5.125 12.7156L12 19.1219L18.8359 12.7156C19.6562 11.9734 20.125 10.9187 20.125 9.78592V9.59061C20.125 7.75467 18.7969 6.23124 17 5.91874C15.8281 5.72342 14.6172 6.11405 13.7578 6.93436L11.9609 8.73124Z"/>';break;case"share":this.classList.add("share"),t.innerHTML='<path d="M21 6.28571C21 8.65179 19.0804 10.5714 16.7143 10.5714C15.4196 10.5714 14.2589 10.0357 13.4554 9.09821L9.4375 11.1071C9.52679 11.4196 9.52679 11.7321 9.52679 12C9.52679 12.3125 9.52679 12.625 9.4375 12.9375L13.4554 14.9018C14.2589 14.0089 15.4196 13.4286 16.7143 13.4286C19.0804 13.4286 21 15.3482 21 17.7143C21 20.0804 19.0804 22 16.7143 22C14.3036 22 12.4286 20.0804 12.4286 17.7143C12.4286 17.4464 12.4286 17.1339 12.5179 16.8214L8.5 14.8125C7.69643 15.75 6.53571 16.2857 5.28571 16.2857C2.875 16.2857 1 14.3661 1 12C1 9.63393 2.875 7.71429 5.28571 7.71429C6.53571 7.71429 7.69643 8.29464 8.5 9.1875L12.5179 7.22321C12.4286 6.91071 12.4286 6.59821 12.4286 6.28571C12.4286 3.91964 14.3036 2 16.7143 2C19.0804 2 21 3.91964 21 6.28571ZM5.24107 14.1429C6.44643 14.1429 7.38393 13.2054 7.38393 12C7.38393 10.8393 6.44643 9.85714 5.24107 9.85714C4.08036 9.85714 3.09821 10.8393 3.09821 12C3.09821 13.2054 4.08036 14.1429 5.24107 14.1429ZM16.7143 4.14286C15.5089 4.14286 14.5714 5.125 14.5714 6.28571C14.5714 7.49107 15.5089 8.42857 16.7143 8.42857C17.875 8.42857 18.8571 7.49107 18.8571 6.28571C18.8571 5.125 17.875 4.14286 16.7143 4.14286ZM16.7143 19.8571C17.875 19.8571 18.8571 18.9196 18.8571 17.7143C18.8571 16.5536 17.875 15.5714 16.7143 15.5714C15.5089 15.5714 14.5714 16.5536 14.5714 17.7143C14.5714 18.9196 15.5089 19.8571 16.7143 19.8571Z"/>'}}}),customElements.define("sw-layer",class extends HTMLElement{connectedCallback(){this.classList.add("layer"),this.innerHTML='\n            <sw-icon icon="outer-close"></sw-icon>\n            <sw-slider></sw-slider>\n        '}}),customElements.define("shorts-works",class extends HTMLElement{constructor(){super(...arguments),this.inlineStyle=this.getAttribute("style")}async connectedCallback(){this.DOM=this.attachShadow({mode:"closed"}),this.stories=await async function(){const e=await fetch("http://localhost:3001");if(e.ok)return e.json()}(),this.storyStore=new e(this),this.DOM.innerHTML="\n            <sw-story-group></sw-story-group>\n            <sw-layer hidden></sw-layer>\n        ";const t=document.createElement("style");t.textContent="@font-face {font-family: 'Noto Sans KR';font-style: normal;font-weight: 400;src: url(//fonts.gstatic.com/ea/notosanskr/v2/NotoSansKR-Regular.woff2) format('woff2'),url(//fonts.gstatic.com/ea/notosanskr/v2/NotoSansKR-Regular.woff) format('woff'),url(//fonts.gstatic.com/ea/notosanskr/v2/NotoSansKR-Regular.otf) format('opentype');}\n\n* {\n    font-family: \"Noto Sans KR\";\n    user-select: none;\n    -moz-user-select: none;\n    -moz-user-select: none;\n    scrollbar-width: none;\n    -webkit-user-drag: none;\n}   \n\n*::-webkit-scrollbar {\n    display: none;\n}.icon {\n    cursor: pointer;\n    z-index: 1;\n    color: rgba(255, 255, 255, 0.48);\n    position: relative;\n    height: 16px;\n    width: 16px;\n}\n\n@media (max-width: 500px) {\n    .icon {\n        height: 32px;\n        width: 32px;\n    }\n}\n\n\n.icon:hover {\n    color: white\n}\n\n.icon-container {\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n    justify-content: end;\n    gap: 4px;\n}\n\n.outer-close {\n    position: absolute;\n    top: 0;\n    right: 0;\n    height: 32px;\n    width: 32px;\n}\n\n@media (max-width: 500px) {\n    .outer-close {\n        display: none;\n    }\n}\n\n.inner-close {\n    position: relative;\n}\n\n.arrow {\n    position: relative;\n    height: 32px;\n    width: 32px;\n}\n\n\n.heart {\n    position: absolute;\n    align-self: flex-end;\n    bottom: 12px;\n}\n\n.share {\n    position: absolute;\n    align-self: flex-end;\n    bottom: 32px;\n}\n\n/* heart 와 share 담는 flex 컨테이너 필요*/\n@media (max-width: 500px) {\n    .share {\n        bottom: 48px;\n    }\n}.layer {\n    position: fixed;\n    height: 100vh;\n    width: 100vw;\n    z-index: 999;\n    top: 0;\n    left: 0;\n    background-color: rgb(0,0,0,0.5);\n    box-sizing: border-box;\n}\n\n.slider {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100vw;\n    height: 100vh;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n}\n\n.axis {\n    align-items: center;\n\n    position: absolute;\n    display: flex;\n    width: 0;\n    height: 0;\n}.story-group {\n    display: flex;\n    flex-direction: row;\n    gap: 20px;\n}\n\n.story {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    position: relative;\n    height: fit-content;\n    gap: 2px;\n    cursor: pointer;\n}\n\n.story-label {\n    background: linear-gradient(0deg, #EC702B, #BC3BE9);\n    color: #FFFF;\n    border-radius: 4px;\n    font-size: 10px;\n    font-weight: 700;\n    padding: 4px;\n    border: 3.4px solid #FFFF;\n    position: absolute;\n    bottom: -6px;\n}\n\n.story-image {\n    width: 160px;\n    aspect-ratio: 9/16;\n    object-fit: cover;\n}\n\n.story-icon {\n    position: relative;\n    padding: 3.4px;\n    border: 3.4px solid transparent;\n    display: flex;\n    justify-content: center;\n    background-image: linear-gradient(white, white), linear-gradient(0deg,  #EC702B, #BC3BE9);\n    background-origin: border-box;\n    background-clip: padding-box, border-box;\n    border-image-slice: 1;\n    width: fit-content;\n}\n\n/* story-shape */\n.round {\n    border-radius: 50%;\n}\n.round > img {\n    width: 88px;\n    aspect-ratio: 1/1;\n    border-radius: 50%;\n\n    display: grid;\n    place-items: center;\n}\n.roundedRect {\n    border-radius: 30%;\n}\n.roundedRect > img {\n    width: 88px;\n    aspect-ratio: 1/1;\n    border-radius: 30%;\n\n    display: grid;\n    place-items: center;\n\n}\n.rect {\n    border-radius: 8px;\n}\n.rect > img {\n    width: 160px;\n    aspect-ratio: 9/16;\n    border-radius: 8px;\n\n    display: grid;\n    place-items: center;\n}.view-container {\n    position: relative;\n    left: 0;\n\n    display: flex;\n    flex-direction: row;\n    height: fit-content;\n    \n    gap: 160px;\n    transition: left 0.5s;\n}\n\n@media (max-width: 500px) {\n    .view-container {\n        gap: 0;\n    }\n}.view {\n    cursor: pointer;\n    position: relative;\n    border-radius: 6px;\n    aspect-ratio: 9/16;\n    box-sizing: border-box;\n    display: flex;\n    align-items: center;\n    background-color: black;\n    justify-content: center;\n\n    width: 200px;\n    transition: transform 0.5s;\n}\n\n@media (max-width: 500px) {\n    .view {\n        width: 100vw;\n        height: 100vh;\n    }\n}\n\n.view-inner {\n    position: relative;\n    height: 100%;\n    width: 100%;\n    border-radius: 6px;\n    overflow: hidden;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n}\n\n.view-thumbnail {\n    position: absolute;\n    height: 100%;\n    width: 100%;\n\n    z-index: 99;\n    border-radius: 6px;\n    box-sizing: border-box;\n    object-fit: cover;\n    opacity: 0.1;\n}.screen {\n    position: absolute;\n    width: 100%;\n    height: 100%;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n}\n\n.content {\n    position: relative;\n    width: 100%;    \n    object-fit: contain;\n}.canvas {\n    position: absolute;\n    width: 100%;\n    height: 100%;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n}\n\n.feed-element {\n    position: absolute;\n}.interface {\n    position: absolute;\n    width: 100%;\n    height: 100%;\n    \n    display: flex;\n    align-items: center;\n    justify-content: center;\n}\n\n.interface-frame {\n    position: relative;\n    display: flex;\n    padding-block: 8px;\n    padding-inline: 4px;\n    box-sizing: border-box;\n\n    flex-direction: column;\n\n    width: 100%;\n    height: 100%;\n    /* border: none; */\n    /* padding: 4px; */\n}.timeline {\n    width: 100%;\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n    gap: 4px;\n    box-sizing: border-box;\n    padding-inline: 2px;\n    padding-block: 4px;\n}\n\n.progress {\n    border-radius: 1px;\n    height: 4px;\n    background-color: rgba(255, 255, 255, 0.48);\n    overflow: hidden;\n}\n\n.gauge {\n    border-radius: 1px;\n    height: 100%;\n    width: 0;\n    background-color: #FFFFFF;\n}.controller {\n    position: absolute;\n    width: 144%;\n    height: 0;\n    display: flex;\n    flex-direction: row;\n    justify-content: space-between;\n    align-items: center;\n}\n\n@media (max-width: 500px) {\n    .controller {\n        visibility: hidden\n    }\n}",this.DOM.appendChild(t)}});
